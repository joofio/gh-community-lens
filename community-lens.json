{
  "resourceType": "Library",
  "id": "community-lens",
  "meta": {
    "profile": [
      "http://hl7.eu/fhir/ig/gravitate-health/StructureDefinition/lens"
    ]
  },
  "type": {
    "coding": [
      {
        "code": "logical-library"
      }
    ]
  },
  "extension": [
    {
      "url": "http://hl7.eu/fhir/ig/gravitate-health/StructureDefinition/lee-version",
      "valueString": "dev"
    }
  ],
  "url": "http://hl7.eu/fhir/ig/gravitate-health/Library/588",
  "identifier": [
    {
      "system": "http://gravitate-health.lst.tfo.upm.es",
      "value": "community-lens"
    }
  ],
  "version": "0.0.1",
  "name": "Community Finder lens",
  "_name": {
    "extension": [
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "es"
          },
          {
            "url": "content",
            "valueString": "Lente para buscar comunidades"
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "pt"
          },
          {
            "url": "content",
            "valueString": "Lente para encontrar comunidades"
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "da"
          },
          {
            "url": "content",
            "valueString": "Linse til at finde fællesskaber"
          }
        ]
      }
    ]
  },
  "title": "community-lens",
  "_title": {
    "extension": [
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "es"
          },
          {
            "url": "content",
            "valueString": "Lente para buscar comunidades"
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "pt"
          },
          {
            "url": "content",
            "valueString": "Lente para encontrar comunidades"
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "da"
          },
          {
            "url": "content",
            "valueString": "Linse til at finde fællesskaber"
          }
        ]
      }
    ]
  },
  "status": "draft",
  "experimental": true,
  "date": "2026-02-12T15:23:04.281Z",
  "publisher": "Gravitate Health Project - UPM Team",
  "contact": [
    {
      "name": "Gravitate Health",
      "telecom": [
        {
          "system": "url",
          "value": "https://www.gravitatehealth.eu/"
        }
      ]
    }
  ],
  "description": "Lens that suggests relevant patient communities based on the patient's conditions and medications",
  "_description": {
    "extension": [
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "es"
          },
          {
            "url": "content",
            "valueString": "Lente que sugiere comunidades de pacientes relevantes según las condiciones y medicamentos del paciente"
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "pt"
          },
          {
            "url": "content",
            "valueString": "Lente que sugere comunidades de pacientes relevantes com base nas condições e medicamentos do paciente"
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "da"
          },
          {
            "url": "content",
            "valueString": "Linse der foreslår relevante patientfællesskaber baseret på patientens tilstande og medicin"
          }
        ]
      }
    ]
  },
  "jurisdiction": [
    {
      "coding": [
        {
          "code": "EU",
          "system": "urn:iso:std:iso:3166"
        }
      ]
    }
  ],
  "purpose": "Add links to relevant patient communities in a preprocessed ePI based on matching conditions and medications.",
  "_purpose": {
    "extension": [
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "es"
          },
          {
            "url": "content",
            "valueString": "Añadir enlaces a comunidades de pacientes relevantes en una ePI preprocesada basándose en condiciones y medicamentos coincidentes."
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "pt"
          },
          {
            "url": "content",
            "valueString": "Adicionar links para comunidades de pacientes relevantes numa ePI pré-processada com base em condições e medicamentos correspondentes."
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "da"
          },
          {
            "url": "content",
            "valueString": "Tilføj links til relevante patientfællesskaber i en forbehandlet ePI baseret på matchende tilstande og medicin."
          }
        ]
      }
    ]
  },
  "usage": "You can import this lens directly to your FHIR Server which suports Library Resource type.",
  "_usage": {
    "extension": [
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "es"
          },
          {
            "url": "content",
            "valueString": "Puedes importar esta lente directamente a tu servidor FHIR que soporte el tipo de recurso Library."
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "pt"
          },
          {
            "url": "content",
            "valueString": "Podes importar esta lente diretamente para o teu servidor FHIR que suporte o tipo de recurso Library."
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "da"
          },
          {
            "url": "content",
            "valueString": "Du kan importere denne linse direkte til din FHIR-server, som understøtter ressource-typen Library."
          }
        ]
      }
    ]
  },
  "copyright": "© 2024 Gravitate Health",
  "parameter": [
    {
      "use": "in",
      "documentation": "parameter if it exists",
      "type": "CodeableConcept"
    }
  ],
  "content": [
    {
      "contentType": "application/javascript",
      "title": "Lens for community finder",
      "data": "bGV0IHB2RGF0YSA9IHB2OwpsZXQgaHRtbERhdGEgPSBodG1sOwoKbGV0IGVwaURhdGEgPSBlcGk7CmxldCBpcHNEYXRhID0gaXBzOwpsZXQgbGFuZyA9ICIiOyAgLy8gRGVmYXVsdCBsYW5ndWFnZSwgd2lsbCBiZSBzZXQgYnkgZVBJCgpsZXQgZ2V0U3BlY2lmaWNhdGlvbiA9ICgpID0+IHsKICAgIHJldHVybiAiMi4wLjMtY29tbXVuaXR5LWJhbm5lciI7Cn07Cgpjb25zdCBnZXRDb21tdW5pdHlIVE1MID0gKG1hdGNoZXMsIGxhbmd1YWdlKSA9PiB7CiAgICBsZXQgaGVhZGluZyA9ICIiOwogICAgbGV0IGludHJvID0gIiI7CiAgICBsZXQgY2FsbFRvQWN0aW9uID0gIiI7CgogICAgaWYgKGxhbmd1YWdlPy5zdGFydHNXaXRoKCJwdCIpKSB7CiAgICAgICAgaGVhZGluZyA9ICLwn5GlIENvbXVuaWRhZGUgcmVsYWNpb25hZGEiOwogICAgICAgIGludHJvID0gIlBvZGUgYmVuZWZpY2lhciBhbyBqdW50YXItc2UgYSB1bWEgY29tdW5pZGFkZSBkZSB1dGlsaXphZG9yZXMgY29tIGV4cGVyacOqbmNpYXMgc2VtZWxoYW50ZXM6IjsKICAgICAgICBjYWxsVG9BY3Rpb24gPSAiVmlzaXRhciBDb211bmlkYWRlIgogICAgfSBlbHNlIGlmIChsYW5ndWFnZT8uc3RhcnRzV2l0aCgiZXMiKSkgewogICAgICAgIGhlYWRpbmcgPSAi8J+RpSBDb211bmlkYWQgcmVsYWNpb25hZGEiOwogICAgICAgIGludHJvID0gIlBvZHLDrWEgYmVuZWZpY2lhcnNlIGFsIHVuaXJzZSBhIHVuYSBjb211bmlkYWQgZGUgcGVyc29uYXMgY29uIGV4cGVyaWVuY2lhcyBzaW1pbGFyZXM6IjsKICAgICAgICBjYWxsVG9BY3Rpb24gPSAiVmlzaXRhciBjb211bmlkYWQiCiAgICB9IGVsc2UgaWYgKGxhbmd1YWdlPy5zdGFydHNXaXRoKCJkYSIpKSB7CiAgICAgICAgaGVhZGluZyA9ICLwn5GlIFJlbGF0ZXJldCBmw6ZsbGVzc2thYiI7CiAgICAgICAgaW50cm8gPSAiRGV0IGthbiB2w6ZyZSBueXR0aWd0IGF0IGRlbHRhZ2UgaSBldCBmw6ZsbGVzc2thYiBtZWQgbGlnbmVuZGUgb3BsZXZlbHNlcjoiOwogICAgICAgIGNhbGxUb0FjdGlvbiA9ICJCZXPDuGcgZsOmbGxlc3NrYWIiCiAgICB9IGVsc2UgewogICAgICAgIGhlYWRpbmcgPSAi8J+RpSBSZWxhdGVkIENvbW11bml0eSI7CiAgICAgICAgaW50cm8gPSAiWW91IG1pZ2h0IGJlbmVmaXQgZnJvbSBqb2luaW5nIGEgY29tbXVuaXR5IG9mIG90aGVycyB3aXRoIHNpbWlsYXIgZXhwZXJpZW5jZXM6IjsKICAgICAgICBjYWxsVG9BY3Rpb24gPSAiVmlzaXQgQ29tbXVuaXR5IgogICAgfQoKICAgIHJldHVybiBgCiAgICAgICAgPGRpdiBjbGFzcz0iY29tbXVuaXR5LWJhbm5lciI+CiAgICAgICAgICAgIDxoMz4ke2hlYWRpbmd9PC9oMz4KICAgICAgICAgICAgPHA+JHtpbnRyb308L3A+CiAgICAgICAgICAgIDx1bD4KICAgICAgICAgICAgICAgICR7bWF0Y2hlcy5tYXAobWF0Y2ggPT4gYAogICAgICAgICAgICAgICAgICAgIDxsaT4KICAgICAgICAgICAgICAgICAgICAgICAgPGEgaHJlZj0iJHttYXRjaC5ocmVmfSIgdGFyZ2V0PSJfYmxhbmsiIGNsYXNzPSJjb21tdW5pdHktbGluayI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICR7Y2FsbFRvQWN0aW9ufQogICAgICAgICAgICAgICAgICAgICAgICA8L2E+CiAgICAgICAgICAgICAgICAgICAgPC9saT5gKS5qb2luKCIiKX0KICAgICAgICAgICAgPC91bD4KICAgICAgICA8L2Rpdj4KICAgICAgICBgOwp9Cgpjb25zdCBpbnNlcnRDb21tdW5pdHlMaW5rID0gKGxpc3RPZkNhdGVnb3JpZXMsIG1hdGNoZXMsIGxhbmd1YWdlLCBkb2N1bWVudCwgcmVzcG9uc2UpID0+IHsKICAgIGlmIChtYXRjaGVzLmxlbmd0aCA9PT0gMCkgewogICAgICAgIHJldHVybiByZXNwb25zZTsKICAgIH0KCiAgICBjb25zdCBjb21tdW5pdHlIVE1MID0gZ2V0Q29tbXVuaXR5SFRNTChtYXRjaGVzLCBsYW5ndWFnZSk7CiAgICBsZXQgaW5qZWN0ZWQgPSBmYWxzZTsKCiAgICBsaXN0T2ZDYXRlZ29yaWVzLmZvckVhY2goKGNsYXNzTmFtZSkgPT4gewogICAgICAgIGNvbnN0IHRhcmdldHMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKGNsYXNzTmFtZSk7CiAgICAgICAgaWYgKHRhcmdldHMubGVuZ3RoID4gMCkgewogICAgICAgICAgICB0YXJnZXRzWzBdLmlubmVySFRNTCA9IGNvbW11bml0eUhUTUw7CiAgICAgICAgICAgIGluamVjdGVkID0gdHJ1ZTsKICAgICAgICB9CiAgICB9KTsKCiAgICBpZiAoIWluamVjdGVkKSB7CiAgICAgICAgY29uc3QgYmFubmVyRGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CiAgICAgICAgYmFubmVyRGl2LmlubmVySFRNTCA9IGNvbW11bml0eUhUTUw7CiAgICAgICAgY29uc3QgYm9keSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoImJvZHkiKTsKICAgICAgICBpZiAoYm9keSkgewogICAgICAgICAgICBib2R5Lmluc2VydEJlZm9yZShiYW5uZXJEaXYsIGJvZHkuZmlyc3RDaGlsZCk7CiAgICAgICAgfQogICAgfQoKICAgIGNvbnN0IGhlYWQgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgiaGVhZCIpWzBdOwogICAgaWYgKGhlYWQpIGhlYWQucmVtb3ZlKCk7CgogICAgY29uc3QgYm9keSA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCJib2R5IilbMF07CiAgICByZXNwb25zZSA9IGJvZHkgPyBib2R5LmlubmVySFRNTCA6IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5pbm5lckhUTUw7CgogICAgaWYgKCFyZXNwb25zZSB8fCByZXNwb25zZS50cmltKCkgPT09ICIiKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJBbm5vdGF0aW9uIHByb2Nlc3MgZmFpbGVkOiBlbXB0eSBvciBudWxsIHJlc3BvbnNlIik7CiAgICB9CgogICAgcmV0dXJuIHJlc3BvbnNlOwp9OwoKbGV0IGVuaGFuY2UgPSBhc3luYyAoKSA9PiB7CiAgICBpZiAoIWlwc0RhdGEgfHwgIWlwc0RhdGEuZW50cnkgfHwgaXBzRGF0YS5lbnRyeS5sZW5ndGggPT09IDApIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIklQUyBpcyBlbXB0eSBvciBpbnZhbGlkLiIpOwogICAgfQogICAgaWYgKCFlcGlEYXRhIHx8ICFlcGlEYXRhLmVudHJ5IHx8IGVwaURhdGEuZW50cnkubGVuZ3RoID09PSAwKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJlUEkgaXMgZW1wdHkgb3IgaW52YWxpZC4iKTsKICAgIH0KCiAgICBsZXQgYXJyYXlPZkNsYXNzZXMgPSBbeyAiY29kZSI6ICJncmF2LTUiLCAic3lzdGVtIjogImh0dHBzOi8vd3d3LmdyYXZpdGF0ZWhlYWx0aC5ldS9zaWQvZG9jIiB9XQoKICAgIGNvbnN0IGNvbW11bml0aWVzID0gewogICAgICAgICJodHRwOi8vaGw3Lm9yZy9maGlyL3NpZC9pY2QtMTAjRTExIjogWyAvLyBEaWFiZXRlcwogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBtZWQ6ICJodHRwOi8vd3d3Lndob2NjLm5vL2F0YyNBMTBCQTAyIiwgLy8gTWV0Zm9ybWluCiAgICAgICAgICAgICAgICBocmVmOiAiaHR0cHM6Ly9jb21tdW5pdHkuaGVhbHRoL21ldGZvcm1pbi1kaWFiZXRlcyIKICAgICAgICAgICAgfQogICAgICAgIF0sCiAgICAgICAgImh0dHA6Ly9obDcub3JnL2ZoaXIvc2lkL2ljZC0xMCNSNTIiOiBbIC8vIFBhaW4KICAgICAgICAgICAgewogICAgICAgICAgICAgICAgbWVkOiAiaHR0cDovL3d3dy53aG9jYy5uby9hdGMjTTAxQUUwMSIsIC8vIElidXByb2ZlbgogICAgICAgICAgICAgICAgaHJlZjogImh0dHBzOi8vY29tbXVuaXR5LmhlYWx0aC9pYnVwcm9mZW4tcGFpbiIKICAgICAgICAgICAgfQogICAgICAgIF0sCiAgICAgICAgImh0dHA6Ly9zbm9tZWQuaW5mby9zY3QjMjU0ODM3MDA5IjogWyAvLyBNYWxpZ25hbnQgbmVvcGxhc20gb2YgYnJlYXN0IChkaXNvcmRlcikKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgbWVkOiAiaHR0cHM6Ly93d3cuZ3Jhdml0YXRlaGVhbHRoLmV1L3NpZC9kb2MjZXBpYnVuZGxlLTEyMyIsIC8vIElidXByb2ZlbgogICAgICAgICAgICAgICAgaHJlZjogImh0dHBzOi8vY29tbXVuaXR5LmhlYWx0aC9pYnVwcm9mZW4tcGFpbiIKICAgICAgICAgICAgfQogICAgICAgIF0sCiAgICB9OwoKICAgIGNvbnN0IG1hdGNoZXMgPSBbXTsKCiAgICBjb25zdCBjb25kaXRpb25zID0gaXBzRGF0YS5lbnRyeQogICAgICAgIC5maWx0ZXIoZSA9PiBlLnJlc291cmNlPy5yZXNvdXJjZVR5cGUgPT09ICJDb25kaXRpb24iKQogICAgICAgIC5mbGF0TWFwKGUgPT4gZS5yZXNvdXJjZS5jb2RlPy5jb2Rpbmc/Lm1hcChjID0+IGAke2Muc3lzdGVtfSMke2MuY29kZX1gKSB8fCBbXSk7CgogICAgY29uc3QgbWVkS2V5cyA9IFtdOwoKICAgIGlmIChlcGlEYXRhLmlkZW50aWZpZXI/LnZhbHVlKSB7CiAgICAgICAgY29uc3Qgc3lzdGVtID0gZXBpRGF0YS5pZGVudGlmaWVyLnN5c3RlbSB8fCAiIjsKICAgICAgICBtZWRLZXlzLnB1c2goYCR7c3lzdGVtfSMke2VwaURhdGEuaWRlbnRpZmllci52YWx1ZX1gKTsKICAgIH0KCiAgICBlcGlEYXRhLmVudHJ5LmZvckVhY2goZW50cnkgPT4gewogICAgICAgIGNvbnN0IHJlcyA9IGVudHJ5LnJlc291cmNlOwogICAgICAgIGlmIChyZXM/LnJlc291cmNlVHlwZSA9PT0gIk1lZGljaW5hbFByb2R1Y3REZWZpbml0aW9uIiAmJiBBcnJheS5pc0FycmF5KHJlcy5pZGVudGlmaWVyKSkgewogICAgICAgICAgICByZXMuaWRlbnRpZmllci5mb3JFYWNoKGlkID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IHN5c3RlbSA9IGlkLnN5c3RlbSB8fCAiIjsKICAgICAgICAgICAgICAgIGlmIChpZC52YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIG1lZEtleXMucHVzaChgJHtzeXN0ZW19IyR7aWQudmFsdWV9YCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgIH0pOwoKICAgIGZvciAoY29uc3QgY29uZEtleSBvZiBjb25kaXRpb25zKSB7CiAgICAgICAgaWYgKGNvbW11bml0aWVzW2NvbmRLZXldKSB7CiAgICAgICAgICAgIGZvciAoY29uc3QgZW50cnkgb2YgY29tbXVuaXRpZXNbY29uZEtleV0pIHsKICAgICAgICAgICAgICAgIGlmIChtZWRLZXlzLmluY2x1ZGVzKGVudHJ5Lm1lZCkpIHsKICAgICAgICAgICAgICAgICAgICBtYXRjaGVzLnB1c2goewogICAgICAgICAgICAgICAgICAgICAgICBtZWRpY2F0aW9uOiBlbnRyeS5tZWQsCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbmRpdGlvbjogY29uZEtleSwKICAgICAgICAgICAgICAgICAgICAgICAgaHJlZjogZW50cnkuaHJlZgogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIGVwaURhdGEuZW50cnk/LmZvckVhY2goKGVudHJ5KSA9PiB7CiAgICAgICAgY29uc3QgcmVzID0gZW50cnkucmVzb3VyY2U7CiAgICAgICAgaWYgKHJlcz8ucmVzb3VyY2VUeXBlID09PSAiQ29tcG9zaXRpb24iICYmIHJlcy5sYW5ndWFnZSkgewogICAgICAgICAgICBsYW5nID0gcmVzLmxhbmd1YWdlOwogICAgICAgIH0KICAgIH0pOwoKICAgIGlmICghbGFuZyAmJiBlcGlEYXRhLmxhbmd1YWdlKSB7CiAgICAgICAgbGFuZyA9IGVwaURhdGEubGFuZ3VhZ2U7CiAgICB9CgogICAgaWYgKCFsYW5nKSB7CiAgICAgICAgbGFuZyA9ICJlbiI7CiAgICB9CgogICAgbGV0IGNvbXBvc2l0aW9ucyA9IDA7CiAgICBsZXQgY2F0ZWdvcmllcyA9IFtdOwoKICAgIGVwaS5lbnRyeS5mb3JFYWNoKChlbnRyeSkgPT4gewogICAgICAgIGlmIChlbnRyeS5yZXNvdXJjZS5yZXNvdXJjZVR5cGUgPT0gIkNvbXBvc2l0aW9uIikgewogICAgICAgICAgICBjb21wb3NpdGlvbnMrKzsKICAgICAgICAgICAgZW50cnkucmVzb3VyY2UuZXh0ZW5zaW9uLmZvckVhY2goKGVsZW1lbnQpID0+IHsKICAgICAgICAgICAgICAgIGlmIChlbGVtZW50LmV4dGVuc2lvblsxXS51cmwgPT0gImNvbmNlcHQiKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGVsZW1lbnQuZXh0ZW5zaW9uWzFdLnZhbHVlQ29kZWFibGVSZWZlcmVuY2UuY29uY2VwdCAhPSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5leHRlbnNpb25bMV0udmFsdWVDb2RlYWJsZVJlZmVyZW5jZS5jb25jZXB0LmNvZGluZy5mb3JFYWNoKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgKGNvZGluZykgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhcnJheU9mQ2xhc3Nlcy5zb21lKGl0ZW0gPT4gaXRlbS5jb2RlID09PSBjb2RpbmcuY29kZSAmJiBpdGVtLnN5c3RlbSA9PT0gY29kaW5nLnN5c3RlbSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2F0ZWdvcmllcy5wdXNoKGVsZW1lbnQuZXh0ZW5zaW9uWzBdLnZhbHVlU3RyaW5nKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICB9KTsKCiAgICBpZiAoY29tcG9zaXRpb25zID09IDApIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0JhZCBlUEk6IG5vIGNhdGVnb3J5ICJDb21wb3NpdGlvbiIgZm91bmQnKTsKICAgIH0KCiAgICBpZiAobWF0Y2hlcy5sZW5ndGggPT0gMCkgewogICAgICAgIHJldHVybiBodG1sRGF0YTsKICAgIH0gZWxzZSB7CiAgICAgICAgbGV0IHJlc3BvbnNlID0gaHRtbERhdGE7CiAgICAgICAgbGV0IGRvY3VtZW50OwoKICAgICAgICBpZiAodHlwZW9mIHdpbmRvdyA9PT0gInVuZGVmaW5lZCIpIHsKICAgICAgICAgICAgbGV0IGpzZG9tID0gYXdhaXQgaW1wb3J0KCJqc2RvbSIpOwogICAgICAgICAgICBsZXQgeyBKU0RPTSB9ID0ganNkb207CiAgICAgICAgICAgIGxldCBkb20gPSBuZXcgSlNET00oaHRtbERhdGEpOwogICAgICAgICAgICBkb2N1bWVudCA9IGRvbS53aW5kb3cuZG9jdW1lbnQ7CiAgICAgICAgICAgIHJldHVybiBpbnNlcnRDb21tdW5pdHlMaW5rKGNhdGVnb3JpZXMsIG1hdGNoZXMsIGxhbmcsIGRvY3VtZW50LCByZXNwb25zZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZG9jdW1lbnQgPSB3aW5kb3cuZG9jdW1lbnQ7CiAgICAgICAgICAgIHJldHVybiBpbnNlcnRDb21tdW5pdHlMaW5rKGNhdGVnb3JpZXMsIG1hdGNoZXMsIGxhbmcsIGRvY3VtZW50LCByZXNwb25zZSk7CiAgICAgICAgfQogICAgfTsKfTsKCmZ1bmN0aW9uIGdldFJlcG9ydChsYW5nID0gImVuIikgewogICAgcmV0dXJuIHsgbWVzc2FnZTogZ2V0RXhwbGFuYXRpb24obGFuZyksIHN0YXR1czogInN1Y2Nlc3MiIH07Cn0KCmZ1bmN0aW9uIGdldEV4cGxhbmF0aW9uKGxhbmcgPSAiZW4iKSB7CiAgICBjb25zdCBleHBsYW5hdGlvbnMgPSB7CiAgICAgICAgZW46ICJUaGlzIGxlbnMgZGlzcGxheXMgbGlua3MgdG8gY29tbXVuaXRpZXMgb2YgcGF0aWVudHMgd2l0aCBzaW1pbGFyIGV4cGVyaWVuY2VzLiIsCiAgICAgICAgcHQ6ICJFc3RhIGxlbnRlIGV4aWJlIGxpbmtzIHBhcmEgY29tdW5pZGFkZXMgZGUgcGFjaWVudGVzIGNvbSBleHBlcmnDqm5jaWFzIHNlbWVsaGFudGVzLiIsCiAgICAgICAgZXM6ICJFc3RhIGxlbnRlIG11ZXN0cmEgZW5sYWNlcyBhIGNvbXVuaWRhZGVzIGRlIHBhY2llbnRlcyBjb24gZXhwZXJpZW5jaWFzIHNpbWlsYXJlcy4iLAogICAgICAgIGRhOiAiRGVubmUgbGluc2UgdmlzZXIgbGlua3MgdGlsIGbDpmxsZXNza2FiZXIgYWYgcGF0aWVudGVyIG1lZCBsaWduZW5kZSBvcGxldmVsc2VyLiIsCiAgICB9OwogICAgcmV0dXJuIGV4cGxhbmF0aW9uc1tsYW5nXSB8fCBleHBsYW5hdGlvbnMuZW47Cn0KCnJldHVybiB7CiAgICBlbmhhbmNlOiBlbmhhbmNlLAogICAgZ2V0U3BlY2lmaWNhdGlvbjogZ2V0U3BlY2lmaWNhdGlvbiwKICAgIGV4cGxhbmF0aW9uOiAobGFuZ3VhZ2UpID0+IGdldEV4cGxhbmF0aW9uKGxhbmd1YWdlIHx8IGxhbmcgfHwgImVuIiksCiAgICByZXBvcnQ6IChsYW5ndWFnZSkgPT4gZ2V0UmVwb3J0KGxhbmd1YWdlIHx8IGxhbmcgfHwgImVuIiksCn07Cg==",
      "_title": {
        "extension": [
          {
            "url": "http://hl7.org/fhir/StructureDefinition/translation",
            "extension": [
              {
                "url": "lang",
                "valueCode": "es"
              },
              {
                "url": "content",
                "valueString": "Lente para buscar comunidades"
              }
            ]
          },
          {
            "url": "http://hl7.org/fhir/StructureDefinition/translation",
            "extension": [
              {
                "url": "lang",
                "valueCode": "pt"
              },
              {
                "url": "content",
                "valueString": "Lente para encontrar comunidades"
              }
            ]
          },
          {
            "url": "http://hl7.org/fhir/StructureDefinition/translation",
            "extension": [
              {
                "url": "lang",
                "valueCode": "da"
              },
              {
                "url": "content",
                "valueString": "Linse til at finde fællesskaber"
              }
            ]
          }
        ]
      }
    }
  ]
}