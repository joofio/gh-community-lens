{
  "resourceType": "Library",
  "id": "community-lens",
  "meta": {
    "profile": [
      "http://hl7.eu/fhir/ig/gravitate-health/StructureDefinition/lens"
    ]
  },
  "type": {
    "coding": [
      {
        "code": "logical-library"
      }
    ]
  },
  "extension": [
    {
      "url": "http://hl7.eu/fhir/ig/gravitate-health/StructureDefinition/lee-version",
      "valueString": "dev"
    }
  ],
  "url": "http://hl7.eu/fhir/ig/gravitate-health/Library/588",
  "identifier": [
    {
      "system": "http://gravitate-health.lst.tfo.upm.es",
      "value": "community-lens"
    }
  ],
  "version": "0.0.1",
  "name": "Community Finder lens",
  "_name": {
    "extension": [
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "es"
          },
          {
            "url": "content",
            "valueString": "Lente para buscar comunidades"
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "pt"
          },
          {
            "url": "content",
            "valueString": "Lente para encontrar comunidades"
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "da"
          },
          {
            "url": "content",
            "valueString": "Linse til at finde fællesskaber"
          }
        ]
      }
    ]
  },
  "title": "community-lens",
  "_title": {
    "extension": [
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "es"
          },
          {
            "url": "content",
            "valueString": "Lente para buscar comunidades"
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "pt"
          },
          {
            "url": "content",
            "valueString": "Lente para encontrar comunidades"
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "da"
          },
          {
            "url": "content",
            "valueString": "Linse til at finde fællesskaber"
          }
        ]
      }
    ]
  },
  "status": "draft",
  "experimental": true,
  "date": "2024-06-12T12:23:10.005Z",
  "publisher": "Gravitate Health Project - UPM Team",
  "contact": [
    {
      "name": "Gravitate Health",
      "telecom": [
        {
          "system": "url",
          "value": "https://www.gravitatehealth.eu/"
        }
      ]
    }
  ],
  "description": "Lens that suggests relevant patient communities based on the patient's conditions and medications",
  "_description": {
    "extension": [
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "es"
          },
          {
            "url": "content",
            "valueString": "Lente que sugiere comunidades de pacientes relevantes según las condiciones y medicamentos del paciente"
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "pt"
          },
          {
            "url": "content",
            "valueString": "Lente que sugere comunidades de pacientes relevantes com base nas condições e medicamentos do paciente"
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "da"
          },
          {
            "url": "content",
            "valueString": "Linse der foreslår relevante patientfællesskaber baseret på patientens tilstande og medicin"
          }
        ]
      }
    ]
  },
  "jurisdiction": [
    {
      "coding": [
        {
          "code": "EU",
          "system": "urn:iso:std:iso:3166"
        }
      ]
    }
  ],
  "purpose": "Add links to relevant patient communities in a preprocessed ePI based on matching conditions and medications.",
  "_purpose": {
    "extension": [
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "es"
          },
          {
            "url": "content",
            "valueString": "Añadir enlaces a comunidades de pacientes relevantes en una ePI preprocesada basándose en condiciones y medicamentos coincidentes."
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "pt"
          },
          {
            "url": "content",
            "valueString": "Adicionar links para comunidades de pacientes relevantes numa ePI pré-processada com base em condições e medicamentos correspondentes."
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "da"
          },
          {
            "url": "content",
            "valueString": "Tilføj links til relevante patientfællesskaber i en forbehandlet ePI baseret på matchende tilstande og medicin."
          }
        ]
      }
    ]
  },
  "usage": "You can import this lens directly to your FHIR Server which suports Library Resource type.",
  "_usage": {
    "extension": [
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "es"
          },
          {
            "url": "content",
            "valueString": "Puedes importar esta lente directamente a tu servidor FHIR que soporte el tipo de recurso Library."
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "pt"
          },
          {
            "url": "content",
            "valueString": "Podes importar esta lente diretamente para o teu servidor FHIR que suporte o tipo de recurso Library."
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "da"
          },
          {
            "url": "content",
            "valueString": "Du kan importere denne linse direkte til din FHIR-server, som understøtter ressource-typen Library."
          }
        ]
      }
    ]
  },
  "copyright": "© 2024 Gravitate Health",
  "parameter": [
    {
      "use": "in",
      "documentation": "parameter if it exists",
      "type": "CodeableConcept"
    }
  ],
  "content": [
    {
      "contentType": "application/javascript",
      "title": "Lens for community finder",
      "data": "bGV0IHB2RGF0YSA9IHB2OwpsZXQgaHRtbERhdGEgPSBodG1sOwoKbGV0IGVwaURhdGEgPSBlcGk7CmxldCBpcHNEYXRhID0gaXBzOwoKbGV0IGdldFNwZWNpZmljYXRpb24gPSAoKSA9PiB7CiAgICByZXR1cm4gIjIuMC4zLWNvbW11bml0eS1iYW5uZXIiOwp9OwovL2RvY3VtZW50LCBodG1sRGF0YSwgYmFubmVySFRNTAoKY29uc3QgaW5zZXJ0Q29tbXVuaXR5TGluayA9IChsaXN0T2ZDYXRlZ29yaWVzLCBtYXRjaGVzLCBsYW5ndWFnZSwgZG9jdW1lbnQsIHJlc3BvbnNlKSA9PiB7CiAgICBsZXQgY29tbXVuaXR5SFRNTCA9ICIiOwoKICAgIGlmIChtYXRjaGVzLmxlbmd0aCA+IDApIHsKICAgICAgICBsZXQgaGVhZGluZyA9ICIiOwogICAgICAgIGxldCBpbnRybyA9ICIiOwoKICAgICAgICBpZiAobGFuZ3VhZ2U/LnN0YXJ0c1dpdGgoInB0IikpIHsKICAgICAgICAgICAgaGVhZGluZyA9ICLwn5GlIENvbXVuaWRhZGUgcmVsYWNpb25hZGEiOwogICAgICAgICAgICBpbnRybyA9ICJQb2RlIGJlbmVmaWNpYXIgYW8ganVudGFyLXNlIGEgdW1hIGNvbXVuaWRhZGUgZGUgdXRpbGl6YWRvcmVzIGNvbSBleHBlcmnDqm5jaWFzIHNlbWVsaGFudGVzOiI7CiAgICAgICAgICAgIGNhbGxUb0FjdGlvbiA9ICJWaXNpdGFyIENvbXVuaWRhZGUiCiAgICAgICAgfSBlbHNlIGlmIChsYW5ndWFnZT8uc3RhcnRzV2l0aCgiZXMiKSkgewogICAgICAgICAgICBoZWFkaW5nID0gIvCfkaUgQ29tdW5pZGFkIHJlbGFjaW9uYWRhIjsKICAgICAgICAgICAgaW50cm8gPSAiUG9kcsOtYSBiZW5lZmljaWFyc2UgYWwgdW5pcnNlIGEgdW5hIGNvbXVuaWRhZCBkZSBwZXJzb25hcyBjb24gZXhwZXJpZW5jaWFzIHNpbWlsYXJlczoiOwogICAgICAgICAgICBjYWxsVG9BY3Rpb24gPSAiVmlzaXRhciBjb211bmlkYWQiCgogICAgICAgIH0gZWxzZSBpZiAobGFuZ3VhZ2U/LnN0YXJ0c1dpdGgoImRhIikpIHsKICAgICAgICAgICAgaGVhZGluZyA9ICLwn5GlIFJlbGF0ZXJldCBmw6ZsbGVzc2thYiI7CiAgICAgICAgICAgIGludHJvID0gIkRldCBrYW4gdsOmcmUgbnl0dGlndCBhdCBkZWx0YWdlIGkgZXQgZsOmbGxlc3NrYWIgbWVkIGxpZ25lbmRlIG9wbGV2ZWxzZXI6IjsKICAgICAgICAgICAgY2FsbFRvQWN0aW9uID0gIkJlc8O4ZyBmw6ZsbGVzc2thYiIKCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaGVhZGluZyA9ICLwn5GlIFJlbGF0ZWQgQ29tbXVuaXR5IjsKICAgICAgICAgICAgaW50cm8gPSAiWW91IG1pZ2h0IGJlbmVmaXQgZnJvbSBqb2luaW5nIGEgY29tbXVuaXR5IG9mIG90aGVycyB3aXRoIHNpbWlsYXIgZXhwZXJpZW5jZXM6IjsKICAgICAgICAgICAgY2FsbFRvQWN0aW9uID0gIlZpc2l0YXIgQ29tdW5pZGFkZSIKCiAgICAgICAgfQoKICAgICAgICBjb21tdW5pdHlIVE1MID0gYAogICAgICAgIDxkaXYgY2xhc3M9ImNvbW11bml0eS1iYW5uZXIiPgogICAgICAgICAgICA8aDM+JHtoZWFkaW5nfTwvaDM+CiAgICAgICAgICAgIDxwPiR7aW50cm99PC9wPgogICAgICAgICAgICA8dWw+CiAgICAgICAgICAgICAgICAke21hdGNoZXMubWFwKG1hdGNoID0+IGAKICAgICAgICAgICAgICAgICAgICA8bGk+CiAgICAgICAgICAgICAgICAgICAgICAgIDxhIGhyZWY9IiR7bWF0Y2guaHJlZn0iIHRhcmdldD0iX2JsYW5rIiBjbGFzcz0iY29tbXVuaXR5LWxpbmsiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAke2NhbGxUb0FjdGlvbn0KICAgICAgICAgICAgICAgICAgICAgICAgPC9hPgogICAgICAgICAgICAgICAgICAgIDwvbGk+YCkuam9pbigiIil9CiAgICAgICAgICAgIDwvdWw+CiAgICAgICAgPC9kaXY+CiAgICAgICAgYDsKICAgIH0gZWxzZSB7CiAgICAgICAgLy8gTm8gbWF0Y2g6IGRvIG5vdCBpbmplY3QgYW55dGhpbmcKICAgICAgICByZXR1cm4gcmVzcG9uc2U7CiAgICB9CgogICAgbGV0IGluamVjdGVkID0gZmFsc2U7CgogICAgbGlzdE9mQ2F0ZWdvcmllcy5mb3JFYWNoKChjbGFzc05hbWUpID0+IHsKICAgICAgICBjb25zb2xlLmxvZyhjbGFzc05hbWUpOwogICAgICAgIGNvbnN0IHRhcmdldHMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKGNsYXNzTmFtZSk7CiAgICAgICAgaWYgKHRhcmdldHMubGVuZ3RoID4gMCkgewogICAgICAgICAgICB0YXJnZXRzWzBdLmlubmVySFRNTCA9IGNvbW11bml0eUhUTUw7CiAgICAgICAgICAgIGluamVjdGVkID0gdHJ1ZTsKICAgICAgICB9CiAgICB9KTsKCiAgICBjb25zb2xlLmxvZyhpbmplY3RlZCk7CiAgICBpZiAoIWluamVjdGVkKSB7CiAgICAgICAgY29uc3QgYmFubmVyRGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CiAgICAgICAgYmFubmVyRGl2LmlubmVySFRNTCA9IGNvbW11bml0eUhUTUw7CiAgICAgICAgY29uc3QgYm9keSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoImJvZHkiKTsKICAgICAgICBpZiAoYm9keSkgewogICAgICAgICAgICBib2R5Lmluc2VydEJlZm9yZShiYW5uZXJEaXYsIGJvZHkuZmlyc3RDaGlsZCk7CiAgICAgICAgfQogICAgfQoKICAgIGNvbnN0IGhlYWQgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgiaGVhZCIpWzBdOwogICAgaWYgKGhlYWQpIGhlYWQucmVtb3ZlKCk7CgogICAgY29uc3QgYm9keSA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCJib2R5IilbMF07CiAgICByZXNwb25zZSA9IGJvZHkgPyBib2R5LmlubmVySFRNTCA6IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5pbm5lckhUTUw7CgogICAgaWYgKCFyZXNwb25zZSB8fCByZXNwb25zZS50cmltKCkgPT09ICIiKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJBbm5vdGF0aW9uIHByb2Nlc3MgZmFpbGVkOiBlbXB0eSBvciBudWxsIHJlc3BvbnNlIik7CiAgICB9CgogICAgcmV0dXJuIHJlc3BvbnNlOwp9OwoKCmxldCBlbmhhbmNlID0gYXN5bmMgKCkgPT4gewogICAgaWYgKCFpcHNEYXRhIHx8ICFpcHNEYXRhLmVudHJ5IHx8IGlwc0RhdGEuZW50cnkubGVuZ3RoID09PSAwKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJJUFMgaXMgZW1wdHkgb3IgaW52YWxpZC4iKTsKICAgIH0KICAgIGlmICghZXBpRGF0YSB8fCAhZXBpRGF0YS5lbnRyeSB8fCBlcGlEYXRhLmVudHJ5Lmxlbmd0aCA9PT0gMCkgewogICAgICAgIHRocm93IG5ldyBFcnJvcigiZVBJIGlzIGVtcHR5IG9yIGludmFsaWQuIik7CiAgICB9CgoKICAgIGxldCBhcnJheU9mQ2xhc3NlcyA9IFt7ICJjb2RlIjogImdyYXYtNSIsICJzeXN0ZW0iOiAiaHR0cHM6Ly93d3cuZ3Jhdml0YXRlaGVhbHRoLmV1L3NpZC9kb2MiIH1dICAgICAgLy93aGF0IHRvIGxvb2sgaW4gZXh0ZW5zaW9ucyAtbWFkZSB1cCBjb2RlIGJlY2F1c2UgdGhlcmUgaXMgbm9uZQoKICAgIGNvbnN0IGNvbW11bml0aWVzID0gewogICAgICAgICJodHRwOi8vaGw3Lm9yZy9maGlyL3NpZC9pY2QtMTAjRTExIjogWyAvLyBEaWFiZXRlcwogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBtZWQ6ICJodHRwOi8vd3d3Lndob2NjLm5vL2F0YyNBMTBCQTAyIiwgLy8gTWV0Zm9ybWluCiAgICAgICAgICAgICAgICBocmVmOiAiaHR0cHM6Ly9jb21tdW5pdHkuaGVhbHRoL21ldGZvcm1pbi1kaWFiZXRlcyIKICAgICAgICAgICAgfQogICAgICAgIF0sCiAgICAgICAgImh0dHA6Ly9obDcub3JnL2ZoaXIvc2lkL2ljZC0xMCNSNTIiOiBbIC8vIFBhaW4KICAgICAgICAgICAgewogICAgICAgICAgICAgICAgbWVkOiAiaHR0cDovL3d3dy53aG9jYy5uby9hdGMjTTAxQUUwMSIsIC8vIElidXByb2ZlbgogICAgICAgICAgICAgICAgaHJlZjogImh0dHBzOi8vY29tbXVuaXR5LmhlYWx0aC9pYnVwcm9mZW4tcGFpbiIKICAgICAgICAgICAgfQogICAgICAgIF0sCiAgICAgICAgImh0dHA6Ly9zbm9tZWQuaW5mby9zY3QjMjU0ODM3MDA5IjogWyAvLyBNYWxpZ25hbnQgbmVvcGxhc20gb2YgYnJlYXN0IChkaXNvcmRlcikKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgbWVkOiAiaHR0cHM6Ly93d3cuZ3Jhdml0YXRlaGVhbHRoLmV1L3NpZC9kb2MjZXBpYnVuZGxlLTEyMyIsIC8vIElidXByb2ZlbgogICAgICAgICAgICAgICAgaHJlZjogImh0dHBzOi8vY29tbXVuaXR5LmhlYWx0aC9pYnVwcm9mZW4tcGFpbiIKICAgICAgICAgICAgfQogICAgICAgIF0sCgogICAgfTsKCiAgICBjb25zdCBtYXRjaGVzID0gW107CgogICAgLy8gRXh0cmFjdCBhbGwgY29uZGl0aW9uIGNvZGluZ3MKICAgIGNvbnN0IGNvbmRpdGlvbnMgPSBpcHNEYXRhLmVudHJ5CiAgICAgICAgLmZpbHRlcihlID0+IGUucmVzb3VyY2U/LnJlc291cmNlVHlwZSA9PT0gIkNvbmRpdGlvbiIpCiAgICAgICAgLmZsYXRNYXAoZSA9PiBlLnJlc291cmNlLmNvZGU/LmNvZGluZz8ubWFwKGMgPT4gYCR7Yy5zeXN0ZW19IyR7Yy5jb2RlfWApIHx8IFtdKTsKCiAgICBjb25zb2xlLmxvZyhjb25kaXRpb25zKTsKICAgIC8vIEV4dHJhY3QgYWxsIG1lZGljYXRpb24gY29kaW5ncwogICAgLy8gY29uc3QgbWVkcyA9IGlwc0RhdGEuZW50cnkKICAgIC8vICAgLmZpbHRlcihlID0+IFsiTWVkaWNhdGlvblJlcXVlc3QiLCAiTWVkaWNhdGlvblN0YXRlbWVudCJdLmluY2x1ZGVzKGUucmVzb3VyY2U/LnJlc291cmNlVHlwZSkpCiAgICAvLyAgLmZsYXRNYXAoZSA9PiBlLnJlc291cmNlLm1lZGljYXRpb25Db2RlYWJsZUNvbmNlcHQ/LmNvZGluZz8ubWFwKGMgPT4gYCR7Yy5zeXN0ZW19IyR7Yy5jb2RlfWApIHx8IFtdKTsKCgogICAgLy8gRXh0cmFpciBpZGVudGlmaWNhZG9yZXMgZGUgbsOtdmVsIEJ1bmRsZQogICAgY29uc3QgbWVkS2V5cyA9IFtdOwoKICAgIGlmIChlcGlEYXRhLmlkZW50aWZpZXI/LnZhbHVlKSB7CiAgICAgICAgY29uc3Qgc3lzdGVtID0gZXBpRGF0YS5pZGVudGlmaWVyLnN5c3RlbSB8fCAiIjsKICAgICAgICBtZWRLZXlzLnB1c2goYCR7c3lzdGVtfSMke2VwaURhdGEuaWRlbnRpZmllci52YWx1ZX1gKTsKICAgIH0KCiAgICAvLyBFeHRyYWlyIGlkZW50aWZpY2Fkb3JlcyBkZSBNZWRpY2luYWxQcm9kdWN0RGVmaW5pdGlvbgogICAgZXBpRGF0YS5lbnRyeS5mb3JFYWNoKGVudHJ5ID0+IHsKICAgICAgICBjb25zdCByZXMgPSBlbnRyeS5yZXNvdXJjZTsKICAgICAgICBpZiAocmVzPy5yZXNvdXJjZVR5cGUgPT09ICJNZWRpY2luYWxQcm9kdWN0RGVmaW5pdGlvbiIgJiYgQXJyYXkuaXNBcnJheShyZXMuaWRlbnRpZmllcikpIHsKICAgICAgICAgICAgcmVzLmlkZW50aWZpZXIuZm9yRWFjaChpZCA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBzeXN0ZW0gPSBpZC5zeXN0ZW0gfHwgIiI7CiAgICAgICAgICAgICAgICBpZiAoaWQudmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBtZWRLZXlzLnB1c2goYCR7c3lzdGVtfSMke2lkLnZhbHVlfWApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICB9KTsKICAgIGNvbnNvbGUubG9nKG1lZEtleXMpOwoKICAgIC8vIE1hdGNoOiBmb3IgZWFjaCBjb25kaXRpb24sIGNoZWNrIGlmIGFueSBtYXRjaGluZyBtZWQgZXhpc3RzCiAgICBmb3IgKGNvbnN0IGNvbmRLZXkgb2YgY29uZGl0aW9ucykgewogICAgICAgIGlmIChjb21tdW5pdGllc1tjb25kS2V5XSkgewogICAgICAgICAgICBmb3IgKGNvbnN0IGVudHJ5IG9mIGNvbW11bml0aWVzW2NvbmRLZXldKSB7CiAgICAgICAgICAgICAgICBpZiAobWVkS2V5cy5pbmNsdWRlcyhlbnRyeS5tZWQpKSB7CiAgICAgICAgICAgICAgICAgICAgbWF0Y2hlcy5wdXNoKHsKICAgICAgICAgICAgICAgICAgICAgICAgbWVkaWNhdGlvbjogZW50cnkubWVkLAogICAgICAgICAgICAgICAgICAgICAgICBjb25kaXRpb246IGNvbmRLZXksCiAgICAgICAgICAgICAgICAgICAgICAgIGhyZWY6IGVudHJ5LmhyZWYKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBsZXQgbGFuZ3VhZ2VEZXRlY3RlZCA9IG51bGw7CgogICAgLy8gMS4gQ2hlY2sgQ29tcG9zaXRpb24ubGFuZ3VhZ2UKICAgIGVwaURhdGEuZW50cnk/LmZvckVhY2goKGVudHJ5KSA9PiB7CiAgICAgICAgY29uc3QgcmVzID0gZW50cnkucmVzb3VyY2U7CiAgICAgICAgaWYgKHJlcz8ucmVzb3VyY2VUeXBlID09PSAiQ29tcG9zaXRpb24iICYmIHJlcy5sYW5ndWFnZSkgewogICAgICAgICAgICBsYW5ndWFnZURldGVjdGVkID0gcmVzLmxhbmd1YWdlOwogICAgICAgICAgICBjb25zb2xlLmxvZygi8J+MjSBEZXRlY3RlZCBmcm9tIENvbXBvc2l0aW9uLmxhbmd1YWdlOiIsIGxhbmd1YWdlRGV0ZWN0ZWQpOwogICAgICAgIH0KICAgIH0pOwoKICAgIC8vIDIuIElmIG5vdCBmb3VuZCwgY2hlY2sgQnVuZGxlLmxhbmd1YWdlCiAgICBpZiAoIWxhbmd1YWdlRGV0ZWN0ZWQgJiYgZXBpRGF0YS5sYW5ndWFnZSkgewogICAgICAgIGxhbmd1YWdlRGV0ZWN0ZWQgPSBlcGlEYXRhLmxhbmd1YWdlOwogICAgICAgIGNvbnNvbGUubG9nKCLwn4yNIERldGVjdGVkIGZyb20gQnVuZGxlLmxhbmd1YWdlOiIsIGxhbmd1YWdlRGV0ZWN0ZWQpOwogICAgfQoKICAgIC8vIDMuIEZhbGxiYWNrIG1lc3NhZ2UKICAgIGlmICghbGFuZ3VhZ2VEZXRlY3RlZCkgewogICAgICAgIGNvbnNvbGUud2Fybigi4pqg77iPIE5vIGxhbmd1YWdlIGRldGVjdGVkIGluIENvbXBvc2l0aW9uIG9yIEJ1bmRsZS4iKTsKICAgIH0KCiAgICAvLyBlUEkgdHJhc2xhdGlvbiBmcm9tIHRlcm1pbm9sb2d5IGNvZGVzIHRvIHRoZWlyIGh1bWFuIHJlZGFibGUgdHJhbnNsYXRpb25zIGluIHRoZSBzZWN0aW9ucwogICAgbGV0IGNvbXBvc2l0aW9ucyA9IDA7CiAgICBsZXQgY2F0ZWdvcmllcyA9IFtdOwoKICAgIGVwaS5lbnRyeS5mb3JFYWNoKChlbnRyeSkgPT4gewogICAgICAgIGlmIChlbnRyeS5yZXNvdXJjZS5yZXNvdXJjZVR5cGUgPT0gIkNvbXBvc2l0aW9uIikgewogICAgICAgICAgICBjb21wb3NpdGlvbnMrKzsKICAgICAgICAgICAgLy9JdGVyYXRlZCB0aHJvdWdoIHRoZSBDb25kaXRpb24gZWxlbWVudCBzZWFyY2hpbmcgZm9yIGNvbmRpdGlvbnMKICAgICAgICAgICAgZW50cnkucmVzb3VyY2UuZXh0ZW5zaW9uLmZvckVhY2goKGVsZW1lbnQpID0+IHsKCiAgICAgICAgICAgICAgICAvLyBDaGVjayBpZiB0aGUgcG9zaXRpb24gb2YgdGhlIGV4dGVuc2lvblsxXSBpcyBjb3JyZWN0CiAgICAgICAgICAgICAgICBpZiAoZWxlbWVudC5leHRlbnNpb25bMV0udXJsID09ICJjb25jZXB0IikgewogICAgICAgICAgICAgICAgICAgIC8vIFNlYXJjaCB0aHJvdWdoIHRoZSBkaWZmZXJlbnQgdGVybWlub2xvZ2llcyB0aGF0IG1heSBiZSBhdmFpYmxlIHRvIGNoZWNrIGluIHRoZSBjb25kaXRpb24KICAgICAgICAgICAgICAgICAgICBpZiAoZWxlbWVudC5leHRlbnNpb25bMV0udmFsdWVDb2RlYWJsZVJlZmVyZW5jZS5jb25jZXB0ICE9IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50LmV4dGVuc2lvblsxXS52YWx1ZUNvZGVhYmxlUmVmZXJlbmNlLmNvbmNlcHQuY29kaW5nLmZvckVhY2goCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAoY29kaW5nKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coIkV4dGVuc2lvbjogIiArIGVsZW1lbnQuZXh0ZW5zaW9uWzBdLnZhbHVlU3RyaW5nICsgIjoiICsgY29kaW5nLmNvZGUgKyAiIC0gIiArIGNvZGluZy5zeXN0ZW0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ2hlY2sgaWYgdGhlIGNvZGUgaXMgaW4gdGhlIGxpc3Qgb2YgY2F0ZWdvcmllcyB0byBzZWFyY2gKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYXJyYXlPZkNsYXNzZXMuc29tZShpdGVtID0+IGl0ZW0uY29kZSA9PT0gY29kaW5nLmNvZGUgJiYgaXRlbS5zeXN0ZW0gPT09IGNvZGluZy5zeXN0ZW0pKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIENoZWNrIGlmIHRoZSBjYXRlZ29yeSBpcyBhbHJlYWR5IGluIHRoZSBsaXN0IG9mIGNhdGVnb3JpZXMKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coIkZvdW5kIiwgZWxlbWVudC5leHRlbnNpb25bMF0udmFsdWVTdHJpbmcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhdGVnb3JpZXMucHVzaChlbGVtZW50LmV4dGVuc2lvblswXS52YWx1ZVN0cmluZyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgfSk7CgogICAgY29uc29sZS5sb2cobWF0Y2hlcyk7CiAgICBpZiAoY29tcG9zaXRpb25zID09IDApIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0JhZCBlUEk6IG5vIGNhdGVnb3J5ICJDb21wb3NpdGlvbiIgZm91bmQnKTsKICAgIH0KCiAgICBpZiAobWF0Y2hlcy5sZW5ndGggPT0gMCkgewogICAgICAgIGNvbnNvbGUubG9nKCJUaGVyZSBhcmUgbm8gbWF0Y2hpbmcgY29tbXVuaXRpZXMgZm9yIHBhaXIgZGlzZWFzZS9tZWRpY2F0aW9uIik7CiAgICAgICAgcmV0dXJuIGh0bWxEYXRhOwogICAgfQoKICAgIGVsc2UgewoKCiAgICAgICAgbGV0IHJlc3BvbnNlID0gaHRtbERhdGE7CiAgICAgICAgbGV0IGRvY3VtZW50OwoKICAgICAgICBpZiAodHlwZW9mIHdpbmRvdyA9PT0gInVuZGVmaW5lZCIpIHsKICAgICAgICAgICAgbGV0IGpzZG9tID0gYXdhaXQgaW1wb3J0KCJqc2RvbSIpOwogICAgICAgICAgICBsZXQgeyBKU0RPTSB9ID0ganNkb207CiAgICAgICAgICAgIGxldCBkb20gPSBuZXcgSlNET00oaHRtbERhdGEpOwogICAgICAgICAgICBkb2N1bWVudCA9IGRvbS53aW5kb3cuZG9jdW1lbnQ7CiAgICAgICAgICAgIHJldHVybiBpbnNlcnRDb21tdW5pdHlMaW5rKGNhdGVnb3JpZXMsIG1hdGNoZXMsIGxhbmd1YWdlRGV0ZWN0ZWQsIGRvY3VtZW50LCByZXNwb25zZSk7CiAgICAgICAgICAgIC8vbGlzdE9mQ2F0ZWdvcmllcywgZW5oYW5jZVRhZywgZG9jdW1lbnQsIHJlc3BvbnNlCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZG9jdW1lbnQgPSB3aW5kb3cuZG9jdW1lbnQ7CiAgICAgICAgICAgIHJldHVybiBpbnNlcnRDb21tdW5pdHlMaW5rKGNhdGVnb3JpZXMsIG1hdGNoZXMsIGxhbmd1YWdlRGV0ZWN0ZWQsIGRvY3VtZW50LCByZXNwb25zZSk7CiAgICAgICAgfQogICAgfTsKfTsKCgpmdW5jdGlvbiBnZXRSZXBvcnQobGFuZykgewogICAgY29uc29sZS5sb2coIkdlbmVyYXRpbmcgcmVwb3J0IGluIGxhbmd1YWdlOiIsIGxhbmcpOwogICAgcmV0dXJuIHsgbWVzc2FnZTogZ2V0RXhwbGFuYXRpb24obGFuZyksIHN0YXR1czogIiIgfTsKCgp9CgovLyAtLS0gR2V0IHVzZXItZmFjaW5nIHJlcG9ydCBzZW50ZW5jZSBpbiB0aGUgc2VsZWN0ZWQgbGFuZ3VhZ2UgLS0tCmZ1bmN0aW9uIGdldEV4cGxhbmF0aW9uKGxhbmcpIHsKICAgIGNvbnNvbGUubG9nKCJHZW5lcmF0aW5nIGV4cGxhbmF0aW9uIGluIGxhbmd1YWdlOiIsIGxhbmcpOwogICAgcmV0dXJuICIiOwp9CgovLyAtLS0gRXhwb3J0ZWQgQVBJIC0tLQpyZXR1cm4gewogICAgZW5oYW5jZTogZW5oYW5jZSwKICAgIGdldFNwZWNpZmljYXRpb246IGdldFNwZWNpZmljYXRpb24sCiAgICBleHBsYW5hdGlvbjogKGxhbmd1YWdlKSA9PiBnZXRFeHBsYW5hdGlvbihsYW5ndWFnZSB8fCBsYW5nKSwKICAgIHJlcG9ydDogKGxhbmd1YWdlKSA9PiBnZXRSZXBvcnQobGFuZ3VhZ2UgfHwgbGFuZyksCn07Cg==",
      "_title": {
        "extension": [
          {
            "url": "http://hl7.org/fhir/StructureDefinition/translation",
            "extension": [
              {
                "url": "lang",
                "valueCode": "es"
              },
              {
                "url": "content",
                "valueString": "Lente para buscar comunidades"
              }
            ]
          },
          {
            "url": "http://hl7.org/fhir/StructureDefinition/translation",
            "extension": [
              {
                "url": "lang",
                "valueCode": "pt"
              },
              {
                "url": "content",
                "valueString": "Lente para encontrar comunidades"
              }
            ]
          },
          {
            "url": "http://hl7.org/fhir/StructureDefinition/translation",
            "extension": [
              {
                "url": "lang",
                "valueCode": "da"
              },
              {
                "url": "content",
                "valueString": "Linse til at finde fællesskaber"
              }
            ]
          }
        ]
      }
    }
  ]
}