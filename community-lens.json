{
  "resourceType": "Library",
  "id": "community-lens",
  "meta": {
    "profile": [
      "http://hl7.eu/fhir/ig/gravitate-health/StructureDefinition/lens"
    ]
  },
  "type": {
    "coding": [
      {
        "code": "logical-library"
      }
    ]
  },
  "extension": [
    {
      "url": "http://hl7.eu/fhir/ig/gravitate-health/StructureDefinition/lee-version",
      "valueString": "dev"
    }
  ],
  "url": "http://hl7.eu/fhir/ig/gravitate-health/Library/588",
  "identifier": [
    {
      "system": "http://gravitate-health.lst.tfo.upm.es",
      "value": "community-lens"
    }
  ],
  "version": "0.0.1",
  "name": "Community Finder lens",
  "_name": {
    "extension": [
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "es"
          },
          {
            "url": "content",
            "valueString": "Lente para buscar comunidades"
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "pt"
          },
          {
            "url": "content",
            "valueString": "Lente para encontrar comunidades"
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "da"
          },
          {
            "url": "content",
            "valueString": "Linse til at finde fællesskaber"
          }
        ]
      }
    ]
  },
  "title": "community-lens",
  "_title": {
    "extension": [
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "es"
          },
          {
            "url": "content",
            "valueString": "Lente para buscar comunidades"
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "pt"
          },
          {
            "url": "content",
            "valueString": "Lente para encontrar comunidades"
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "da"
          },
          {
            "url": "content",
            "valueString": "Linse til at finde fællesskaber"
          }
        ]
      }
    ]
  },
  "status": "draft",
  "experimental": true,
  "date": "2024-06-12T12:23:10.005Z",
  "publisher": "Gravitate Health Project - UPM Team",
  "contact": [
    {
      "name": "Gravitate Health",
      "telecom": [
        {
          "system": "url",
          "value": "https://www.gravitatehealth.eu/"
        }
      ]
    }
  ],
  "description": "Lens that suggests relevant patient communities based on the patient's conditions and medications",
  "_description": {
    "extension": [
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "es"
          },
          {
            "url": "content",
            "valueString": "Lente que sugiere comunidades de pacientes relevantes según las condiciones y medicamentos del paciente"
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "pt"
          },
          {
            "url": "content",
            "valueString": "Lente que sugere comunidades de pacientes relevantes com base nas condições e medicamentos do paciente"
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "da"
          },
          {
            "url": "content",
            "valueString": "Linse der foreslår relevante patientfællesskaber baseret på patientens tilstande og medicin"
          }
        ]
      }
    ]
  },
  "jurisdiction": [
    {
      "coding": [
        {
          "code": "EU",
          "system": "urn:iso:std:iso:3166"
        }
      ]
    }
  ],
  "purpose": "Add links to relevant patient communities in a preprocessed ePI based on matching conditions and medications.",
  "_purpose": {
    "extension": [
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "es"
          },
          {
            "url": "content",
            "valueString": "Añadir enlaces a comunidades de pacientes relevantes en una ePI preprocesada basándose en condiciones y medicamentos coincidentes."
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "pt"
          },
          {
            "url": "content",
            "valueString": "Adicionar links para comunidades de pacientes relevantes numa ePI pré-processada com base em condições e medicamentos correspondentes."
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "da"
          },
          {
            "url": "content",
            "valueString": "Tilføj links til relevante patientfællesskaber i en forbehandlet ePI baseret på matchende tilstande og medicin."
          }
        ]
      }
    ]
  },
  "usage": "You can import this lens directly to your FHIR Server which suports Library Resource type.",
  "_usage": {
    "extension": [
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "es"
          },
          {
            "url": "content",
            "valueString": "Puedes importar esta lente directamente a tu servidor FHIR que soporte el tipo de recurso Library."
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "pt"
          },
          {
            "url": "content",
            "valueString": "Podes importar esta lente diretamente para o teu servidor FHIR que suporte o tipo de recurso Library."
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "da"
          },
          {
            "url": "content",
            "valueString": "Du kan importere denne linse direkte til din FHIR-server, som understøtter ressource-typen Library."
          }
        ]
      }
    ]
  },
  "copyright": "© 2024 Gravitate Health",
  "parameter": [
    {
      "use": "in",
      "documentation": "parameter if it exists",
      "type": "CodeableConcept"
    }
  ],
  "content": [
    {
      "contentType": "application/javascript",
      "title": "Lens for community finder",
      "data": "bGV0IHB2RGF0YSA9IHB2OwpsZXQgaHRtbERhdGEgPSBodG1sOwoKbGV0IGVwaURhdGEgPSBlcGk7CmxldCBpcHNEYXRhID0gaXBzOwpsZXQgbGFuZyA9ICIiOyAgLy8gRGVmYXVsdCBsYW5ndWFnZSwgd2lsbCBiZSBzZXQgYnkgZVBJCgpsZXQgZ2V0U3BlY2lmaWNhdGlvbiA9ICgpID0+IHsKICAgIHJldHVybiAiMi4wLjMtY29tbXVuaXR5LWJhbm5lciI7Cn07Ci8vZG9jdW1lbnQsIGh0bWxEYXRhLCBiYW5uZXJIVE1MCgpjb25zdCBpbnNlcnRDb21tdW5pdHlMaW5rID0gKGxpc3RPZkNhdGVnb3JpZXMsIG1hdGNoZXMsIGxhbmd1YWdlLCBkb2N1bWVudCwgcmVzcG9uc2UpID0+IHsKICAgIGxldCBjb21tdW5pdHlIVE1MID0gIiI7CgogICAgaWYgKG1hdGNoZXMubGVuZ3RoID4gMCkgewogICAgICAgIGxldCBoZWFkaW5nID0gIiI7CiAgICAgICAgbGV0IGludHJvID0gIiI7CgogICAgICAgIGlmIChsYW5ndWFnZT8uc3RhcnRzV2l0aCgicHQiKSkgewogICAgICAgICAgICBoZWFkaW5nID0gIvCfkaUgQ29tdW5pZGFkZSByZWxhY2lvbmFkYSI7CiAgICAgICAgICAgIGludHJvID0gIlBvZGUgYmVuZWZpY2lhciBhbyBqdW50YXItc2UgYSB1bWEgY29tdW5pZGFkZSBkZSB1dGlsaXphZG9yZXMgY29tIGV4cGVyacOqbmNpYXMgc2VtZWxoYW50ZXM6IjsKICAgICAgICAgICAgY2FsbFRvQWN0aW9uID0gIlZpc2l0YXIgQ29tdW5pZGFkZSIKICAgICAgICB9IGVsc2UgaWYgKGxhbmd1YWdlPy5zdGFydHNXaXRoKCJlcyIpKSB7CiAgICAgICAgICAgIGhlYWRpbmcgPSAi8J+RpSBDb211bmlkYWQgcmVsYWNpb25hZGEiOwogICAgICAgICAgICBpbnRybyA9ICJQb2Ryw61hIGJlbmVmaWNpYXJzZSBhbCB1bmlyc2UgYSB1bmEgY29tdW5pZGFkIGRlIHBlcnNvbmFzIGNvbiBleHBlcmllbmNpYXMgc2ltaWxhcmVzOiI7CiAgICAgICAgICAgIGNhbGxUb0FjdGlvbiA9ICJWaXNpdGFyIGNvbXVuaWRhZCIKCiAgICAgICAgfSBlbHNlIGlmIChsYW5ndWFnZT8uc3RhcnRzV2l0aCgiZGEiKSkgewogICAgICAgICAgICBoZWFkaW5nID0gIvCfkaUgUmVsYXRlcmV0IGbDpmxsZXNza2FiIjsKICAgICAgICAgICAgaW50cm8gPSAiRGV0IGthbiB2w6ZyZSBueXR0aWd0IGF0IGRlbHRhZ2UgaSBldCBmw6ZsbGVzc2thYiBtZWQgbGlnbmVuZGUgb3BsZXZlbHNlcjoiOwogICAgICAgICAgICBjYWxsVG9BY3Rpb24gPSAiQmVzw7hnIGbDpmxsZXNza2FiIgoKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBoZWFkaW5nID0gIvCfkaUgUmVsYXRlZCBDb21tdW5pdHkiOwogICAgICAgICAgICBpbnRybyA9ICJZb3UgbWlnaHQgYmVuZWZpdCBmcm9tIGpvaW5pbmcgYSBjb21tdW5pdHkgb2Ygb3RoZXJzIHdpdGggc2ltaWxhciBleHBlcmllbmNlczoiOwogICAgICAgICAgICBjYWxsVG9BY3Rpb24gPSAiVmlzaXRhciBDb211bmlkYWRlIgoKICAgICAgICB9CgogICAgICAgIGNvbW11bml0eUhUTUwgPSBgCiAgICAgICAgPGRpdiBjbGFzcz0iY29tbXVuaXR5LWJhbm5lciI+CiAgICAgICAgICAgIDxoMz4ke2hlYWRpbmd9PC9oMz4KICAgICAgICAgICAgPHA+JHtpbnRyb308L3A+CiAgICAgICAgICAgIDx1bD4KICAgICAgICAgICAgICAgICR7bWF0Y2hlcy5tYXAobWF0Y2ggPT4gYAogICAgICAgICAgICAgICAgICAgIDxsaT4KICAgICAgICAgICAgICAgICAgICAgICAgPGEgaHJlZj0iJHttYXRjaC5ocmVmfSIgdGFyZ2V0PSJfYmxhbmsiIGNsYXNzPSJjb21tdW5pdHktbGluayI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICR7Y2FsbFRvQWN0aW9ufQogICAgICAgICAgICAgICAgICAgICAgICA8L2E+CiAgICAgICAgICAgICAgICAgICAgPC9saT5gKS5qb2luKCIiKX0KICAgICAgICAgICAgPC91bD4KICAgICAgICA8L2Rpdj4KICAgICAgICBgOwogICAgfSBlbHNlIHsKICAgICAgICAvLyBObyBtYXRjaDogZG8gbm90IGluamVjdCBhbnl0aGluZwogICAgICAgIHJldHVybiByZXNwb25zZTsKICAgIH0KCiAgICBsZXQgaW5qZWN0ZWQgPSBmYWxzZTsKCiAgICBsaXN0T2ZDYXRlZ29yaWVzLmZvckVhY2goKGNsYXNzTmFtZSkgPT4gewogICAgICAgIGNvbnNvbGUubG9nKGNsYXNzTmFtZSk7CiAgICAgICAgY29uc3QgdGFyZ2V0cyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoY2xhc3NOYW1lKTsKICAgICAgICBpZiAodGFyZ2V0cy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIHRhcmdldHNbMF0uaW5uZXJIVE1MID0gY29tbXVuaXR5SFRNTDsKICAgICAgICAgICAgaW5qZWN0ZWQgPSB0cnVlOwogICAgICAgIH0KICAgIH0pOwoKICAgIGNvbnNvbGUubG9nKGluamVjdGVkKTsKICAgIGlmICghaW5qZWN0ZWQpIHsKICAgICAgICBjb25zdCBiYW5uZXJEaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsKICAgICAgICBiYW5uZXJEaXYuaW5uZXJIVE1MID0gY29tbXVuaXR5SFRNTDsKICAgICAgICBjb25zdCBib2R5ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiYm9keSIpOwogICAgICAgIGlmIChib2R5KSB7CiAgICAgICAgICAgIGJvZHkuaW5zZXJ0QmVmb3JlKGJhbm5lckRpdiwgYm9keS5maXJzdENoaWxkKTsKICAgICAgICB9CiAgICB9CgogICAgY29uc3QgaGVhZCA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCJoZWFkIilbMF07CiAgICBpZiAoaGVhZCkgaGVhZC5yZW1vdmUoKTsKCiAgICBjb25zdCBib2R5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImJvZHkiKVswXTsKICAgIHJlc3BvbnNlID0gYm9keSA/IGJvZHkuaW5uZXJIVE1MIDogZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmlubmVySFRNTDsKCiAgICBpZiAoIXJlc3BvbnNlIHx8IHJlc3BvbnNlLnRyaW0oKSA9PT0gIiIpIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkFubm90YXRpb24gcHJvY2VzcyBmYWlsZWQ6IGVtcHR5IG9yIG51bGwgcmVzcG9uc2UiKTsKICAgIH0KCiAgICByZXR1cm4gcmVzcG9uc2U7Cn07CgoKbGV0IGVuaGFuY2UgPSBhc3luYyAoKSA9PiB7CiAgICBpZiAoIWlwc0RhdGEgfHwgIWlwc0RhdGEuZW50cnkgfHwgaXBzRGF0YS5lbnRyeS5sZW5ndGggPT09IDApIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIklQUyBpcyBlbXB0eSBvciBpbnZhbGlkLiIpOwogICAgfQogICAgaWYgKCFlcGlEYXRhIHx8ICFlcGlEYXRhLmVudHJ5IHx8IGVwaURhdGEuZW50cnkubGVuZ3RoID09PSAwKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJlUEkgaXMgZW1wdHkgb3IgaW52YWxpZC4iKTsKICAgIH0KCgogICAgbGV0IGFycmF5T2ZDbGFzc2VzID0gW3sgImNvZGUiOiAiZ3Jhdi01IiwgInN5c3RlbSI6ICJodHRwczovL3d3dy5ncmF2aXRhdGVoZWFsdGguZXUvc2lkL2RvYyIgfV0gICAgICAvL3doYXQgdG8gbG9vayBpbiBleHRlbnNpb25zIC1tYWRlIHVwIGNvZGUgYmVjYXVzZSB0aGVyZSBpcyBub25lCgogICAgY29uc3QgY29tbXVuaXRpZXMgPSB7CiAgICAgICAgImh0dHA6Ly9obDcub3JnL2ZoaXIvc2lkL2ljZC0xMCNFMTEiOiBbIC8vIERpYWJldGVzCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIG1lZDogImh0dHA6Ly93d3cud2hvY2Mubm8vYXRjI0ExMEJBMDIiLCAvLyBNZXRmb3JtaW4KICAgICAgICAgICAgICAgIGhyZWY6ICJodHRwczovL2NvbW11bml0eS5oZWFsdGgvbWV0Zm9ybWluLWRpYWJldGVzIgogICAgICAgICAgICB9CiAgICAgICAgXSwKICAgICAgICAiaHR0cDovL2hsNy5vcmcvZmhpci9zaWQvaWNkLTEwI1I1MiI6IFsgLy8gUGFpbgogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBtZWQ6ICJodHRwOi8vd3d3Lndob2NjLm5vL2F0YyNNMDFBRTAxIiwgLy8gSWJ1cHJvZmVuCiAgICAgICAgICAgICAgICBocmVmOiAiaHR0cHM6Ly9jb21tdW5pdHkuaGVhbHRoL2lidXByb2Zlbi1wYWluIgogICAgICAgICAgICB9CiAgICAgICAgXSwKICAgICAgICAiaHR0cDovL3Nub21lZC5pbmZvL3NjdCMyNTQ4MzcwMDkiOiBbIC8vIE1hbGlnbmFudCBuZW9wbGFzbSBvZiBicmVhc3QgKGRpc29yZGVyKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBtZWQ6ICJodHRwczovL3d3dy5ncmF2aXRhdGVoZWFsdGguZXUvc2lkL2RvYyNlcGlidW5kbGUtMTIzIiwgLy8gSWJ1cHJvZmVuCiAgICAgICAgICAgICAgICBocmVmOiAiaHR0cHM6Ly9jb21tdW5pdHkuaGVhbHRoL2lidXByb2Zlbi1wYWluIgogICAgICAgICAgICB9CiAgICAgICAgXSwKCiAgICB9OwoKICAgIGNvbnN0IG1hdGNoZXMgPSBbXTsKCiAgICAvLyBFeHRyYWN0IGFsbCBjb25kaXRpb24gY29kaW5ncwogICAgY29uc3QgY29uZGl0aW9ucyA9IGlwc0RhdGEuZW50cnkKICAgICAgICAuZmlsdGVyKGUgPT4gZS5yZXNvdXJjZT8ucmVzb3VyY2VUeXBlID09PSAiQ29uZGl0aW9uIikKICAgICAgICAuZmxhdE1hcChlID0+IGUucmVzb3VyY2UuY29kZT8uY29kaW5nPy5tYXAoYyA9PiBgJHtjLnN5c3RlbX0jJHtjLmNvZGV9YCkgfHwgW10pOwoKICAgIGNvbnNvbGUubG9nKGNvbmRpdGlvbnMpOwogICAgLy8gRXh0cmFjdCBhbGwgbWVkaWNhdGlvbiBjb2RpbmdzCiAgICAvLyBjb25zdCBtZWRzID0gaXBzRGF0YS5lbnRyeQogICAgLy8gICAuZmlsdGVyKGUgPT4gWyJNZWRpY2F0aW9uUmVxdWVzdCIsICJNZWRpY2F0aW9uU3RhdGVtZW50Il0uaW5jbHVkZXMoZS5yZXNvdXJjZT8ucmVzb3VyY2VUeXBlKSkKICAgIC8vICAuZmxhdE1hcChlID0+IGUucmVzb3VyY2UubWVkaWNhdGlvbkNvZGVhYmxlQ29uY2VwdD8uY29kaW5nPy5tYXAoYyA9PiBgJHtjLnN5c3RlbX0jJHtjLmNvZGV9YCkgfHwgW10pOwoKCiAgICAvLyBFeHRyYWlyIGlkZW50aWZpY2Fkb3JlcyBkZSBuw612ZWwgQnVuZGxlCiAgICBjb25zdCBtZWRLZXlzID0gW107CgogICAgaWYgKGVwaURhdGEuaWRlbnRpZmllcj8udmFsdWUpIHsKICAgICAgICBjb25zdCBzeXN0ZW0gPSBlcGlEYXRhLmlkZW50aWZpZXIuc3lzdGVtIHx8ICIiOwogICAgICAgIG1lZEtleXMucHVzaChgJHtzeXN0ZW19IyR7ZXBpRGF0YS5pZGVudGlmaWVyLnZhbHVlfWApOwogICAgfQoKICAgIC8vIEV4dHJhaXIgaWRlbnRpZmljYWRvcmVzIGRlIE1lZGljaW5hbFByb2R1Y3REZWZpbml0aW9uCiAgICBlcGlEYXRhLmVudHJ5LmZvckVhY2goZW50cnkgPT4gewogICAgICAgIGNvbnN0IHJlcyA9IGVudHJ5LnJlc291cmNlOwogICAgICAgIGlmIChyZXM/LnJlc291cmNlVHlwZSA9PT0gIk1lZGljaW5hbFByb2R1Y3REZWZpbml0aW9uIiAmJiBBcnJheS5pc0FycmF5KHJlcy5pZGVudGlmaWVyKSkgewogICAgICAgICAgICByZXMuaWRlbnRpZmllci5mb3JFYWNoKGlkID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IHN5c3RlbSA9IGlkLnN5c3RlbSB8fCAiIjsKICAgICAgICAgICAgICAgIGlmIChpZC52YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIG1lZEtleXMucHVzaChgJHtzeXN0ZW19IyR7aWQudmFsdWV9YCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgIH0pOwogICAgY29uc29sZS5sb2cobWVkS2V5cyk7CgogICAgLy8gTWF0Y2g6IGZvciBlYWNoIGNvbmRpdGlvbiwgY2hlY2sgaWYgYW55IG1hdGNoaW5nIG1lZCBleGlzdHMKICAgIGZvciAoY29uc3QgY29uZEtleSBvZiBjb25kaXRpb25zKSB7CiAgICAgICAgaWYgKGNvbW11bml0aWVzW2NvbmRLZXldKSB7CiAgICAgICAgICAgIGZvciAoY29uc3QgZW50cnkgb2YgY29tbXVuaXRpZXNbY29uZEtleV0pIHsKICAgICAgICAgICAgICAgIGlmIChtZWRLZXlzLmluY2x1ZGVzKGVudHJ5Lm1lZCkpIHsKICAgICAgICAgICAgICAgICAgICBtYXRjaGVzLnB1c2goewogICAgICAgICAgICAgICAgICAgICAgICBtZWRpY2F0aW9uOiBlbnRyeS5tZWQsCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbmRpdGlvbjogY29uZEtleSwKICAgICAgICAgICAgICAgICAgICAgICAgaHJlZjogZW50cnkuaHJlZgogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8vIDEuIENoZWNrIENvbXBvc2l0aW9uLmxhbmd1YWdlCiAgICBlcGlEYXRhLmVudHJ5Py5mb3JFYWNoKChlbnRyeSkgPT4gewogICAgICAgIGNvbnN0IHJlcyA9IGVudHJ5LnJlc291cmNlOwogICAgICAgIGlmIChyZXM/LnJlc291cmNlVHlwZSA9PT0gIkNvbXBvc2l0aW9uIiAmJiByZXMubGFuZ3VhZ2UpIHsKICAgICAgICAgICAgbGFuZyA9IHJlcy5sYW5ndWFnZTsKICAgICAgICAgICAgY29uc29sZS5sb2coIvCfjI0gRGV0ZWN0ZWQgZnJvbSBDb21wb3NpdGlvbi5sYW5ndWFnZToiLCBsYW5nKTsKICAgICAgICB9CiAgICB9KTsKCiAgICAvLyAyLiBJZiBub3QgZm91bmQsIGNoZWNrIEJ1bmRsZS5sYW5ndWFnZQogICAgaWYgKCFsYW5nICYmIGVwaURhdGEubGFuZ3VhZ2UpIHsKICAgICAgICBsYW5nID0gZXBpRGF0YS5sYW5ndWFnZTsKICAgICAgICBjb25zb2xlLmxvZygi8J+MjSBEZXRlY3RlZCBmcm9tIEJ1bmRsZS5sYW5ndWFnZToiLCBsYW5nKTsKICAgIH0KCiAgICAvLyAzLiBGYWxsYmFjawogICAgaWYgKCFsYW5nKSB7CiAgICAgICAgY29uc29sZS53YXJuKCLimqDvuI8gTm8gbGFuZ3VhZ2UgZGV0ZWN0ZWQgaW4gQ29tcG9zaXRpb24gb3IgQnVuZGxlLiIpOwogICAgICAgIGxhbmcgPSAiZW4iOwogICAgfQoKICAgIC8vIGVQSSB0cmFzbGF0aW9uIGZyb20gdGVybWlub2xvZ3kgY29kZXMgdG8gdGhlaXIgaHVtYW4gcmVkYWJsZSB0cmFuc2xhdGlvbnMgaW4gdGhlIHNlY3Rpb25zCiAgICBsZXQgY29tcG9zaXRpb25zID0gMDsKICAgIGxldCBjYXRlZ29yaWVzID0gW107CgogICAgZXBpLmVudHJ5LmZvckVhY2goKGVudHJ5KSA9PiB7CiAgICAgICAgaWYgKGVudHJ5LnJlc291cmNlLnJlc291cmNlVHlwZSA9PSAiQ29tcG9zaXRpb24iKSB7CiAgICAgICAgICAgIGNvbXBvc2l0aW9ucysrOwogICAgICAgICAgICAvL0l0ZXJhdGVkIHRocm91Z2ggdGhlIENvbmRpdGlvbiBlbGVtZW50IHNlYXJjaGluZyBmb3IgY29uZGl0aW9ucwogICAgICAgICAgICBlbnRyeS5yZXNvdXJjZS5leHRlbnNpb24uZm9yRWFjaCgoZWxlbWVudCkgPT4gewoKICAgICAgICAgICAgICAgIC8vIENoZWNrIGlmIHRoZSBwb3NpdGlvbiBvZiB0aGUgZXh0ZW5zaW9uWzFdIGlzIGNvcnJlY3QKICAgICAgICAgICAgICAgIGlmIChlbGVtZW50LmV4dGVuc2lvblsxXS51cmwgPT0gImNvbmNlcHQiKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gU2VhcmNoIHRocm91Z2ggdGhlIGRpZmZlcmVudCB0ZXJtaW5vbG9naWVzIHRoYXQgbWF5IGJlIGF2YWlibGUgdG8gY2hlY2sgaW4gdGhlIGNvbmRpdGlvbgogICAgICAgICAgICAgICAgICAgIGlmIChlbGVtZW50LmV4dGVuc2lvblsxXS52YWx1ZUNvZGVhYmxlUmVmZXJlbmNlLmNvbmNlcHQgIT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuZXh0ZW5zaW9uWzFdLnZhbHVlQ29kZWFibGVSZWZlcmVuY2UuY29uY2VwdC5jb2RpbmcuZm9yRWFjaCgKICAgICAgICAgICAgICAgICAgICAgICAgICAgIChjb2RpbmcpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygiRXh0ZW5zaW9uOiAiICsgZWxlbWVudC5leHRlbnNpb25bMF0udmFsdWVTdHJpbmcgKyAiOiIgKyBjb2RpbmcuY29kZSArICIgLSAiICsgY29kaW5nLnN5c3RlbSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBDaGVjayBpZiB0aGUgY29kZSBpcyBpbiB0aGUgbGlzdCBvZiBjYXRlZ29yaWVzIHRvIHNlYXJjaAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhcnJheU9mQ2xhc3Nlcy5zb21lKGl0ZW0gPT4gaXRlbS5jb2RlID09PSBjb2RpbmcuY29kZSAmJiBpdGVtLnN5c3RlbSA9PT0gY29kaW5nLnN5c3RlbSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ2hlY2sgaWYgdGhlIGNhdGVnb3J5IGlzIGFscmVhZHkgaW4gdGhlIGxpc3Qgb2YgY2F0ZWdvcmllcwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygiRm91bmQiLCBlbGVtZW50LmV4dGVuc2lvblswXS52YWx1ZVN0cmluZykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2F0ZWdvcmllcy5wdXNoKGVsZW1lbnQuZXh0ZW5zaW9uWzBdLnZhbHVlU3RyaW5nKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICB9KTsKCiAgICBjb25zb2xlLmxvZyhtYXRjaGVzKTsKICAgIGlmIChjb21wb3NpdGlvbnMgPT0gMCkgewogICAgICAgIHRocm93IG5ldyBFcnJvcignQmFkIGVQSTogbm8gY2F0ZWdvcnkgIkNvbXBvc2l0aW9uIiBmb3VuZCcpOwogICAgfQoKICAgIGlmIChtYXRjaGVzLmxlbmd0aCA9PSAwKSB7CiAgICAgICAgY29uc29sZS5sb2coIlRoZXJlIGFyZSBubyBtYXRjaGluZyBjb21tdW5pdGllcyBmb3IgcGFpciBkaXNlYXNlL21lZGljYXRpb24iKTsKICAgICAgICByZXR1cm4gaHRtbERhdGE7CiAgICB9CgogICAgZWxzZSB7CgoKICAgICAgICBsZXQgcmVzcG9uc2UgPSBodG1sRGF0YTsKICAgICAgICBsZXQgZG9jdW1lbnQ7CgogICAgICAgIGlmICh0eXBlb2Ygd2luZG93ID09PSAidW5kZWZpbmVkIikgewogICAgICAgICAgICBsZXQganNkb20gPSBhd2FpdCBpbXBvcnQoImpzZG9tIik7CiAgICAgICAgICAgIGxldCB7IEpTRE9NIH0gPSBqc2RvbTsKICAgICAgICAgICAgbGV0IGRvbSA9IG5ldyBKU0RPTShodG1sRGF0YSk7CiAgICAgICAgICAgIGRvY3VtZW50ID0gZG9tLndpbmRvdy5kb2N1bWVudDsKICAgICAgICAgICAgcmV0dXJuIGluc2VydENvbW11bml0eUxpbmsoY2F0ZWdvcmllcywgbWF0Y2hlcywgbGFuZywgZG9jdW1lbnQsIHJlc3BvbnNlKTsKICAgICAgICAgICAgLy9saXN0T2ZDYXRlZ29yaWVzLCBlbmhhbmNlVGFnLCBkb2N1bWVudCwgcmVzcG9uc2UKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBkb2N1bWVudCA9IHdpbmRvdy5kb2N1bWVudDsKICAgICAgICAgICAgcmV0dXJuIGluc2VydENvbW11bml0eUxpbmsoY2F0ZWdvcmllcywgbWF0Y2hlcywgbGFuZywgZG9jdW1lbnQsIHJlc3BvbnNlKTsKICAgICAgICB9CiAgICB9Owp9OwoKCmZ1bmN0aW9uIGdldFJlcG9ydChsYW5nID0gImVuIikgewogICAgY29uc29sZS5sb2coIkdlbmVyYXRpbmcgcmVwb3J0IGluIGxhbmd1YWdlOiIsIGxhbmcpOwogICAgcmV0dXJuIHsgbWVzc2FnZTogZ2V0RXhwbGFuYXRpb24obGFuZyksIHN0YXR1czogIiIgfTsKCgp9CgovLyAtLS0gR2V0IHVzZXItZmFjaW5nIHJlcG9ydCBzZW50ZW5jZSBpbiB0aGUgc2VsZWN0ZWQgbGFuZ3VhZ2UgLS0tCmZ1bmN0aW9uIGdldEV4cGxhbmF0aW9uKGxhbmcgPSAiZW4iKSB7CiAgICBjb25zb2xlLmxvZygiR2VuZXJhdGluZyBleHBsYW5hdGlvbiBpbiBsYW5ndWFnZToiLCBsYW5nKTsKICAgIHJldHVybiAiIjsKfQoKLy8gLS0tIEV4cG9ydGVkIEFQSSAtLS0KcmV0dXJuIHsKICAgIGVuaGFuY2U6IGVuaGFuY2UsCiAgICBnZXRTcGVjaWZpY2F0aW9uOiBnZXRTcGVjaWZpY2F0aW9uLAogICAgZXhwbGFuYXRpb246IChsYW5ndWFnZSkgPT4gZ2V0RXhwbGFuYXRpb24obGFuZ3VhZ2UgfHwgbGFuZyB8fCAiZW4iKSwKICAgIHJlcG9ydDogKGxhbmd1YWdlKSA9PiBnZXRSZXBvcnQobGFuZ3VhZ2UgfHwgbGFuZyB8fCAiZW4iKSwKfTsK",
      "_title": {
        "extension": [
          {
            "url": "http://hl7.org/fhir/StructureDefinition/translation",
            "extension": [
              {
                "url": "lang",
                "valueCode": "es"
              },
              {
                "url": "content",
                "valueString": "Lente para buscar comunidades"
              }
            ]
          },
          {
            "url": "http://hl7.org/fhir/StructureDefinition/translation",
            "extension": [
              {
                "url": "lang",
                "valueCode": "pt"
              },
              {
                "url": "content",
                "valueString": "Lente para encontrar comunidades"
              }
            ]
          },
          {
            "url": "http://hl7.org/fhir/StructureDefinition/translation",
            "extension": [
              {
                "url": "lang",
                "valueCode": "da"
              },
              {
                "url": "content",
                "valueString": "Linse til at finde fællesskaber"
              }
            ]
          }
        ]
      }
    }
  ]
}